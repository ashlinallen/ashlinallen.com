<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<script type="text/javascript" src="js/vendor/jquery-1.11.1.min.js"></script>

<script type="text/javascript">
    $(document).ready(function(){
        $('#toggleDesaturate').click(function(){
            var imgObj = document.getElementById('image');
            
            //if($.browser.msie){
            //    grayscaleImageIE(imgObj);
            //} else {
            //    imgObj.src = grayscaleImage(imgObj);
            //}           
            
                imgObj.src = grayscaleImage(imgObj);
        });
    });

    function grayscaleImageIE(imgObj)
    {
        imgObj.style.filter = 'progid:DXImageTransform.Microsoft.BasicImage(grayScale=1)';
    }

    function grayscaleImage(imgObj)
    {
        var canvas = document.createElement('canvas');
        var canvasContext = canvas.getContext('2d');
        
        var imgW = imgObj.width;
        var imgH = imgObj.height;
        canvas.width = imgW;
        canvas.height = imgH;
        
        canvasContext.drawImage(imgObj, 0, 0);
        var imgPixels = canvasContext.getImageData(0, 0, imgW, imgH);
        
        for(var y = 0; y < imgPixels.height; y++){
            for(var x = 0; x < imgPixels.width; x++){
                var i = (y * 4) * imgPixels.width + x * 4;
                var avg = (imgPixels.data[i] + imgPixels.data[i + 1] + imgPixels.data[i + 2]) / 3;
                imgPixels.data[i] = avg; 
                imgPixels.data[i + 1] = avg; 
                imgPixels.data[i + 2] = avg;
            }
        }
        
        canvasContext.putImageData(imgPixels, 0, 0, 0, 0, imgPixels.width, imgPixels.height);
        return canvas.toDataURL();
    }
</script>

</head>
<body>

    <div id="page">
        <div>
            <p>
                <strong>Original image:</strong><br/>
                <img src="img/arcade.png" alt="" />
            </p>           
            <p>
                <strong>Image which will be desaturated:</strong><br/>
	            <img src="img/arcade.png" alt="" id="image" />
            </p>           
        </div>
        <form><button id="toggleDesaturate" type="button">Desaturate Image</button></form>
    </div>
</body>
</html>